<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Check‚ÄëIn</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; max-width: 560px; margin: 0 auto; padding: 16px; line-height: 1.4; }
    header { display:flex; justify-content:space-between; align-items:center; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin-top:12px; }
    label { display:block; margin:10px 0 4px; font-weight:600; }
    input[type=range]{ width:100%; }
    textarea { width:100%; height:96px; }
    button { padding:12px 16px; border:0; border-radius:10px; margin-top:12px; cursor:pointer; }
    nav { display:flex; gap:8px; margin-top:8px; }
    .muted { color:#666; font-size:0.9em; }
    .row { display:flex; gap:8px; align-items:center; }
    .row output { width:2ch; text-align:center; }
    .list { margin:0; padding:0; list-style:none; }
    .list li { padding:10px 0; border-bottom:1px dashed #ddd; }
    .right { text-align:right; }
    .toggle { display:flex; align-items:center; gap:8px; }
    .btn-row { display:flex; flex-wrap:wrap; gap:8px; }
    /* Lock overlay */
    #lockOverlay {
      position: fixed; inset: 0; background: #ffffff; z-index: 9999;
      display: flex; align-items: center; justify-content: center; padding: 24px;
    }
    #lockCard {
      width: 100%; max-width: 360px; border: 1px solid #e5e5e5; border-radius: 14px; padding: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
    }
    #pin { font-size: 22px; letter-spacing: 6px; text-align: center; width: 100%; padding: 10px; }
    .error { color:#b00020; }
  </style>
</head>
<body>
  <div id="lockOverlay" hidden>
    <div id="lockCard">
      <h2 id="lockTitle">Set a 4‚Äëdigit passcode</h2>
      <div id="setupBlock">
        <input id="pinSetup1" type="password" inputmode="numeric" maxlength="4" placeholder="Enter 4 digits" style="width:100%; padding:10px; font-size:20px;">
        <input id="pinSetup2" type="password" inputmode="numeric" maxlength="4" placeholder="Confirm passcode" style="width:100%; padding:10px; font-size:20px; margin-top:8px;">
        <button id="savePin">Save Passcode</button>
        <div class="muted">Stored only on this device. You can change it later in Settings.</div>
        <div id="lockMsg" class="error"></div>
      </div>
      <div id="unlockBlock" hidden>
        <input id="pin" type="password" inputmode="numeric" maxlength="4" placeholder="Enter passcode">
        <button id="unlockBtn">Unlock</button>
        <div id="unlockMsg" class="error"></div>
      </div>
    </div>
  </div>

  <header>
    <h1>Daily Check‚ÄëIn</h1>
    <nav>
      <button id="tab-checkin">Check‚Äëin</button>
      <button id="tab-history">History</button>
      <button id="tab-settings">Settings</button>
    </nav>
  </header>

  <section id="screen-checkin" class="card">
    <div class="muted" id="now"></div>
    <label>Physical (1‚Äì5)</label>
    <div class="row">
      <input type="range" id="physical" min="1" max="5" value="3" oninput="phOut.value=this.value">
      <output id="phOut">3</output>
    </div>

    <label>Emotional (1‚Äì5)</label>
    <div class="row">
      <input type="range" id="emotional" min="1" max="5" value="3" oninput="emOut.value=this.value">
      <output id="emOut">3</output>
    </div>

    <label>Mental (1‚Äì5)</label>
    <div class="row">
      <input type="range" id="mental" min="1" max="5" value="3" oninput="meOut.value=this.value">
      <output id="meOut">3</output>
    </div>

    <label>Spiritual (1‚Äì5)</label>
    <div class="row">
      <input type="range" id="spiritual" min="1" max="5" value="3" oninput="spOut.value=this.value">
      <output id="spOut">3</output>
    </div>

    <label>Overall mood</label>
    <select id="mood">
      <option>üòÄ Great</option>
      <option selected>üôÇ Okay</option>
      <option>üòê Meh</option>
      <option>üòü Low</option>
    </select>

    <label>Notes (optional)</label>
    <textarea id="notes" placeholder="One or two sentences‚Ä¶"></textarea>

    <button id="save">Save today‚Äôs check‚Äëin</button>
    <div id="saveStatus" class="muted"></div>
  </section>

  <section id="screen-history" class="card" hidden>
    <h2>Last 7 days</h2>
    <ul id="history" class="list"></ul>
    <div class="right muted" id="avg"></div>
  </section>

  <section id="screen-settings" class="card" hidden>
    <h2>Settings</h2>
    <div class="toggle">
      <input type="checkbox" id="syncEnabled">
      <label for="syncEnabled">Enable encrypted sync</label>
    </div>
    <label>Sync passphrase (keep secret)</label>
    <input type="password" id="passphrase" placeholder="e.g., correct horse battery staple" style="width:100%">
    <label>n8n Webhook URL (optional)</label>
    <input type="url" id="webhook" placeholder="https://your-n8n/rest/webhook/checkin" style="width:100%">
    <div class="btn-row">
      <button id="runSync">Run Sync Now</button>
      <button id="exportCsv">Export CSV</button>
      <button id="exportJson">Backup JSON</button>
      <button id="lockNow">Lock Now</button>
      <button id="changePin">Change Passcode</button>
      <button id="clearAll" style="background:#fee">Clear All Data</button>
    </div>
    <label>Auto‚Äëlock after (minutes)</label>
    <input id="idleMinutes" type="number" min="1" max="60" value="2" style="width:100px">
    <div class="muted">Entries and settings stay on this device. Passcode is not recoverable if forgotten.</div>
  </section>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
